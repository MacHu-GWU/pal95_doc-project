.. _属性以及战斗机制:

属性以及战斗机制
==============================================================================

.. contents::
    :depth: 1
    :local:


.. _基础属性:

基础属性
------------------------------------------------------------------------------

**攻击**:

物理攻击力, 攻击越高, 物理攻击造成的伤害就越高.

**防御**:

对物理和法术攻击的防御力.

**身法**:

- 决定回避率, 身法越高, 回避敌人的物理攻击的几率就越高, 成功回避则不会受到任何伤害.
- 身法还决定出招顺序, 同一类的攻击, 如物理攻击, 身法最高的人首先发动.

**灵力**:

法术攻击力, 灵力越高, 法术造成的伤害就越高.

**吉运**:

吉运越高, 越不容易中毒, 疯狂等. 同时, ``飞龙探云手`` 和 ``逃跑`` 的成功几率也越高.

可惜公式没解出来.

猜测公式: ``每回合吉运 = 吉运 * (1 + rnd(-0.1, 0.1))``

猜测生效判定: ``敌方吉运之和 - 我方单人吉运`` 大于0, 则逃跑成功; 小于等于0则失败; 这也解释了为什么多怪时很难逃跑.


.. _基础知识:

基础知识
------------------------------------------------------------------------------

- 敌方武力 = 敌方基础武力 + (敌方等级 + 6) * 6
- 敌方灵力 = 敌方基础灵力 + (敌方等级 + 6) * 6
- 敌方防御 = 敌方基础防御 + (敌方等级 + 6) * 4
- 敌方身法 = 敌方基础身法 + (敌方等级 + 6) * 3
- 敌方吉运 = 敌方基础吉运 + (敌方等级 + 6) * 4

伤害计算:

(注: 此处的公式与下面的 我方普攻和仙术攻击敌方时造成的伤害_ 和 敌方普攻和仙术攻击我方时造成的伤害_ 有出入, 以下面的为准)

- 若攻击属性 (武力和灵力) > 防御属性: damage = 攻击属性 - 0.8 * 防御属性
- 若防御属性 > 攻击属性 > 0.6 * 防御属性: damage = 0.5 * 攻击属性 - 0.3 * 防御属性
- 若攻击属性 < 0.6 * 防御属性: damage = 0


.. _我方普攻和仙术攻击敌方时造成的伤害:

我方普攻和仙术攻击敌方时造成的伤害
------------------------------------------------------------------------------

.. contents::
    :depth: 1
    :local:

注: rnd为随机函数, 比如rnd(x) 为取0到x的任意小数, rnd(x, y) 为取x到y之间的任意小数. (均为均匀分布)


普攻
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 单攻: (我方武力 - 敌方防御) * 2 * (1 + rnd(1/8)) / 敌物抗 + rnd(1)
- 群攻: (我方武力 - 敌方防御) * 2 / 敌物抗 * 位置系数
- 位置系数: 从右往左, 先下后上的顺序算 (1/2) ^ (n-1), 分别为: 1, 0.5, 0.25, 0.125, 0.0625


普攻暴击
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 所有人: 1/6概率 (``高攻状态`` / ``天罡战气`` 下100%) 出现 3 倍伤害.
- 李逍遥: 1/12 概率出现 2 倍伤害. 其他人没有这个机制.

二者可同时发生, 即李逍遥有1/72的概率出现6倍伤害.

- 仙术五灵: 仙术基础伤害 + (我方灵力 - 敌方防御) / 2 * (1 + rnd(1/10)) * (10 - 敌该属性抗性) / 5 *(10 + 战地对应属性) / 10
- 仙术毒系: 仙术基础伤害 + (我方灵力 - 敌方防御) / 2 * (1 + rnd(1/10)) * (10 - 敌该属性抗性) / 5
- 剑系和绝系: 仙术基础伤害 + (我方灵力 - 敌方防御) / 2 * (1 + rnd(1/10))
- 灵葫咒和夺魂: (当前敌方体力 + 1), 所以灵葫咒生效的最多体力值为（敌方总体力 / 4 - 1）
- 合击: 法术基础伤害 + (所有人基础武力 + 所有人基础灵力) / 4 - 敌方防御) / 2 * (1 + rnd(1/10)) * (10 - 敌该属性抗性) / 5 * (10 + 战地对应属性) / 10.

基础是指不加装备属性的人物属性. :ref:`战地对应属性 <场景属性一览>` 是这场战斗的背景对应的属性, 与在哪个迷宫其实无关.


酒神与乾坤一掷伤害计算
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

**酒神**:

伤害 = 当前真气 * 8. 酒神造成的伤害不受抗性和防御影响.

**乾坤一掷**:

伤害 = 消耗的金钱数 * 0.4. 最多消耗5000金钱, 不足5000时消耗全部金钱.

附言：因为我方攻击属性基本都比敌方防御高, 所以可以认为是减0.8敌方防御


.. _敌方普攻和仙术攻击我方时造成的伤害:

敌方普攻和仙术攻击我方时造成的伤害
------------------------------------------------------------------------------

.. contents::
    :depth: 1
    :local:

首先我们要了解 ``免伤机制`` 和 ``属性抗性`` 的概念.


我方属性抗性
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
默认都为50%, 带五毒珠为毒抗100%.

免伤率:

五大灵珠为对应属性50%, 圣灵珠, 香袋, 玉佛珠为毒免30%.


高攻状态
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

上文的 ``高攻状态`` 就是 ``天罡战气``


高防状态
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

游戏中有3种免伤效果, 相互独立作用.

- **高防状态**: 有 ``真元护体`` 或 ``金刚咒`` 时 受到的伤害 -50%.
- **随机格挡**: 敌人的物理和法术攻击有几率触发我方 ``格挡``. 发生 ``格挡`` 时, 受到的伤害 -50%.
- **防御状态**:``防御`` 状态下, 受到的伤害 -50%.

比如如果3种状态同时触发, 则只受到 (1 - 0.5) * (1 - 0.5) * (1 - 0.5) = 12.5% 的伤害.


免伤率
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

三种 ``高防状态`` 的叠加值为免伤率. 例如3种高防状态同时发生, 则免伤率为 87.5%.


- 敌方普攻攻击对我方造成的伤害: (敌方武力 - 我方防御) * (1 + rnd(1/8)) * (1 - 免伤率)
- 敌方仙术攻击对我方造成的伤害: 法术基础伤害 + (敌方灵力 - 我方防御) * (1 + rnd(1/10)) * (1 - 我方该属性抗性) * (1 + 战地对应属性) * (1 - 免伤率)

注: 关于 :ref:`战地对应属性 <场景属性一览>`


敌方普攻和仙术对我方造成的伤害
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 敌方普攻攻击对我方造成的伤害: (敌方武力 - 我方防御) * (1 + rnd(1/8)) * (1 - 免伤率)
- 敌方仙术攻击对我方造成的伤害: 法术基础伤害 + (敌方灵力 - 我方防御) * (1 + rnd(1/10)) * (1 - 我方该属性抗性) * (1 + 战地对应属性) * (1 - 免伤率)

注: 关于 :ref:`战地对应属性 <场景属性一览>`


.. _行动顺序:

行动顺序
------------------------------------------------------------------------------

首先系统根据双方团队的 ``总加权身法`` 决定 ``敌方`` 和 ``我方`` 谁先行动. 然后在 ``敌方`` 和 ``我方`` 团队中, 各个人物按照 ``行动系数`` 决定行动顺序, ``行动系数`` **越高, 则越先执行**.


行动系数
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- **合击** = 10
- **防御** = 5
- **对我方使用法术 / 物品** = 3
- **加速状态** = 3
- **逃跑** = 2
- **虚弱** = 1/2
- **死亡则** = 0
- **攻击或对敌方使用仙术** = 1

敌方所有行动的 ``行动系数`` 都为1.

结论:

- 逃跑总是先执行
- 对我方使用法术 / 物品 总是优先于 攻击
- 合击总是最优先执行, 会覆盖其他任务的所有其他指令


团队总加权身法
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

``团队总加权身法`` 等于团队中所有 ``人物单独的加权身法`` 之和. 人物单独的加权身法 = 身法 * rnd(0.9, 1.1) * 行动系数.
